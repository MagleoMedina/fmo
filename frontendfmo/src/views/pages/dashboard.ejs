<!DOCTYPE html>
<html lang="es">
<head>
    <%- include('../partials/head') %>
    <title><%= title %></title>
    <style>
        /* --- ESTILOS PERSONALIZADOS PARA LAS CARDS --- */
        
        /* Animaci√≥n base */
        .stat-card {
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: none;
            overflow: hidden;
            position: relative;
            z-index: 1;
        }

        /* Efecto Hover (Levantar y Sombra) */
        .stat-card:hover, .stat-card:focus-within {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22) !important;
            cursor:none;
            z-index: 2;
        }

        /* C√≠rculo decorativo de fondo (opcional para est√©tica moderna) */
        .stat-card::after {
            content: "";
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            z-index: -1;
            transition: transform 0.5s;
        }
        
        .stat-card:hover::after {
            transform: scale(1.5);
        }

        /* Estilo para el n√∫mero grande */
        .stat-number {
            font-size: 3.5rem;
            font-weight: 800;
            line-height: 1;
        }

        /* Estilo para las cards tipo "Cubo" (hacemos que sean altas) */
        .card-cube {
            min-height: 220px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Estilo para la card rectangular */
        .card-wide {
            min-height: 150px;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            padding: 0 50px;
        }

        /* En m√≥vil, la rectangular se comporta normal */
        @media (max-width: 768px) {
            .card-wide {
                flex-direction: column;
                text-align: center;
                padding: 20px;
            }
        }
    </style>
</head>
<body>

    <div class="wrapper">
        
        <%- include('../partials/sidebar') %>

        <div id="content" class="w-100 bg-light">
            
            <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm px-4">
                <div class="container-fluid">
                    <span class="navbar-brand mb-0 h1">Panel de Control</span>
                </div>
            </nav>

            <div class="container-fluid p-4">
                <div class="row">
                    <div class="col-12 mb-4">
                        <h3 class="fw-bold text-dark">Resumen de Operaciones</h3>
                        <p class="text-muted">M√©tricas en tiempo real del departamento de telem√°tica.</p>
                    </div>
                </div>

                <div class="row g-4 mb-4">
                    
                    <div class="col-md-4">
                        <div class="card stat-card card-cube bg-primary text-white rounded-4 shadow-sm" tabindex="0">
                            <div class="card-body text-center">
                                <div class="mb-2" style="font-size: 2.5rem;">üñ•Ô∏è</div>
                                <h2 class="stat-number mb-2" id="numEquipos">0</h2>
                                <h6 class="card-title text-uppercase fw-bold" style="letter-spacing: 1px;">Equipos<br>Atendidos</h6>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card stat-card card-cube bg-success text-white rounded-4 shadow-sm" tabindex="0">
                            <div class="card-body text-center">
                                <div class="mb-2" style="font-size: 2.5rem;">‚å®Ô∏è</div>
                                <h2 class="stat-number mb-2" id="numPerifericos">0</h2>
                                <h6 class="card-title text-uppercase fw-bold" style="letter-spacing: 1px;">Perif√©ricos<br>Atendidos</h6>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="card stat-card card-cube bg-info text-white rounded-4 shadow-sm" tabindex="0">
                            <div class="card-body text-center">
                                <div class="mb-2" style="font-size: 2.5rem;">üöö</div>
                                <h2 class="stat-number mb-2" id="numDaet">0</h2>
                                <h6 class="card-title text-uppercase fw-bold" style="letter-spacing: 1px;">Entregas DAET<br>Atendidas</h6>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <div class="card stat-card card-wide bg-warning text-dark rounded-4 shadow-sm" tabindex="0">
                            <div class="text-start">
                                <h2 class="stat-number mb-0" id="numPendientes">0</h2>
                                <p class="mb-0 fw-bold fs-5">TOTAL PENDIENTES</p>
                            </div>
                            <div class="text-end d-none d-md-block">
                                <div style="font-size: 4rem; opacity: 0.5;">‚è≥</div>
                            </div>
                            <div class="d-block d-md-none mt-2">
                                <span class="badge bg-dark">Atenci√≥n Requerida</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script src="/js/bootstrap/bootstrap.bundle.min.js"></script>

    <script>
        // L√≥gica para cargar los n√∫meros desde el Backend
        document.addEventListener('DOMContentLoaded', () => {
            cargarEstadisticas();
        });

        async function cargarEstadisticas() {
            // Animaci√≥n de carga inicial (opcional)
            const elementos = ['numEquipos', 'numPerifericos', 'numDaet', 'numPendientes'];
            elementos.forEach(id => document.getElementById(id).innerText = '-');

            try {
                // AQU√ç SE CONSUMEN TUS ENDPOINTS
                // Asumimos que tienes un controlador en Spring Boot que devuelve estos n√∫meros
                // Puedes hacer 1 llamada que devuelva todo el objeto o 4 llamadas separadas.
                // Ejemplo con 4 llamadas separadas:

                // 1. Equipos
                const resEquipos = await fetch('http://127.0.0.1:8081/api/contador/reciboDeEquipos');
                const dataEquipos = await resEquipos.json(); // Se asume devuelve un entero, ej: 45
                animarNumero('numEquipos', dataEquipos);

                // 2. Perif√©ricos
                const resPeri = await fetch('http://127.0.0.1:8081/api/contador/reciboDePerifericos');
                const dataPeri = await resPeri.json();
                animarNumero('numPerifericos', dataPeri);

                // 3. DAET
                const resDaet = await fetch('http://127.0.0.1:8081/api/contador/entregasAlDaet');
                const dataDaet = await resDaet.json();
                console.log(dataDaet);
                animarNumero('numDaet', dataDaet);

                // 4. Pendientes
                const resPend = await fetch('http://127.0.0.1:8081/api/contador/pendientes');
                const dataPend = await resPend.json();
                animarNumero('numPendientes', dataPend);

            } catch (error) {
                console.error("Error cargando estad√≠sticas:", error);
                // Si falla, ponemos 0 o un mensaje de error
                elementos.forEach(id => {
                    if(document.getElementById(id).innerText === '-') document.getElementById(id).innerText = '0';
                });
            }
        }

        // Funci√≥n para animar el conteo (Efecto visual de 0 a N)
        function animarNumero(idElemento, valorFinal) {
            const elemento = document.getElementById(idElemento);
            const valor = parseInt(valorFinal) || 0;
            let inicio = 0;
            const duracion = 1000; // 1 segundo
            const incremento = Math.ceil(valor / (duracion / 16)); // 60 FPS

            if (valor === 0) {
                elemento.innerText = 0;
                return;
            }

            const timer = setInterval(() => {
                inicio += incremento;
                if (inicio >= valor) {
                    elemento.innerText = valor;
                    clearInterval(timer);
                } else {
                    elemento.innerText = inicio;
                }
            }, 16);
        }
    </script>
</body>
</html>
